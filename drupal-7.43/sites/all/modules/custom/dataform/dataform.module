<?php

/**
 * @file
 * A module for adding js of a dropdown menu for the user to select the data they want to display in the BioJs component.
 */

/**
this implements Hook init 
this loads all non-cached pages
*/
function dataform_init() {
  if (current_path() == 'node/1') {
    drupal_add_js('misc/dataform_menu.js');
    drupal_add_js('jQuery(document).ready(function () { alert("Hello from the dataform.module!"); });', 'inline');
  }
}
//  //since this file should only be loaded on the front page, it cannot be declared in the info file.
 /* if (drupal_is_front_page()) {
    drupal_add_css(drupal_get_path('module', 'dataform_menu')) . '/dataform.css');
  }*/
//}


// autocomplete function

//echo "hello from the dataform.module simple php echo msg";

$servername = "localhost";
$username = "root";
$password = "root";
$dbname = "expvip_related";

// Create connection
$conn = mysqli_connect($servername, $username, $password, $dbname);
// Check connection
if (!$conn) {
    die("Connection failed: " . mysqli_connect_error());
}

//$sql = "SELECT id, name, gene FROM genes";
$sql = "SELECT name FROM gene_sets";
$result = mysqli_query($conn, $sql);
$rows = array();

// somewhere here I will result cache my SQL results
// I need to limit the fetching of results to 20 rows 

if (mysqli_num_rows($result) > 0) {
    // output data of each row
    while($row = mysqli_fetch_assoc($result)) {
      $rows[] = $row;
      echo "<script type='text/javascript'>
            var e = <?php Print($rows); ?>;
            alert(e);
            </script>
        ";
      print json_encode($rows);
      //return json_encode($rows);
    }
    /*echo "
            <script type=\"text/javascript\">
              var e = <?php Print($rows); ?>;
              console.log(\"hello\");
            </script>
        ";
      print json_encode($rows);*/
     // this prints [{"name":"IWGSC2.26"}] //for the autcomplete I need something like this  { label: "Wheat" },
    
     // $data = json_encode($result, JSON_PRETTY_PRINT);
     // echo ($data);
    //  echo json_encode(("name: " . $row["name"]), JSON_PRETTY_PRINT). "<br>";
//         echo "id: " . $row["id"]. " - Name: " . $row["name"]. " " . $row["gene"]. "<br>";

  //  }
} else {
    echo "0 results";
}
mysqli_close($conn);
/*

$sth = mysqli_query("SELECT ...");
$rows = array();
while($r = mysqli_fetch_assoc($sth)) {
    $rows[] = $r;
}
print json_encode($rows);*/


/**
Implements Hook_menu
*/

function dataform_menu() {

  $items['dataform-page'] = array(
  'title' => 'my dataform module',
  'page callback' => 'dataform_page',
  'access arguments' => array('access content'),
  
  );
  return $items;
}

?>
<script type="text/javascript">
  var color = "<?php Print($rows); ?>";
  //alert("hello" color);
  console.log("hello am  here");
</script>
<!-- 
/** 
* Implementation of hook_init()
* Add CSS, Javascript and settings to the page
*/

// function dataform_menu_init() {
//   drupal_add_js(drupal_get_path('module', 'dataform_menu') .'/dataform_menu.js');
//   $settings = variable_get('dataform_menu_effects', unserialize(DATAFORM_MENU_DEFAULT));
//   drupal_add_js(array('dataformMenu' => $settings), 'setting');
// }
/*
def autocomplete
    #puts "In autocomplete!"
    gene_set_id = session[:gene_set_id] 
    @genes = Gene.order(:name).where("name LIKE ? and gene_set_id = ?", "%#{params[:term]}%", gene_set_id).limit(20)

    respond_to do |format|
      format.html
      format.json { 
        render json: @genes.map(&:name)
      }
    end
  end*/
 -->